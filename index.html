<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plastic Tap Factory Hub | Admin</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <style>
        :root {
            --primary: #00f2ff;
            --bg: #050a14;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        body { background: var(--bg); color: var(--text); min-height: 100vh; }

        /* Login */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #0a192f, #050a14);
            display: flex; align-items: center; justify-content: center; z-index: 2000;
        }

        /* Glass Cards */
        .glass-card {
            background: var(--glass); backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border); border-radius: 20px;
            padding: 25px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        }

        /* Dashboard & Navigation */
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; display: none; }
        .nav-tabs { display: flex; gap: 15px; margin-bottom: 30px; justify-content: center; flex-wrap: wrap; }
        .tab-btn {
            background: var(--glass); border: 1px solid var(--primary); color: white;
            padding: 12px 25px; border-radius: 30px; cursor: pointer; font-family: 'Orbitron';
        }
        .tab-btn.active { background: var(--primary); color: #000; font-weight: bold; }

        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.5s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Forms */
        input, select {
            width: 100%; padding: 12px; background: rgba(0,0,0,0.4);
            border: 1px solid var(--glass-border); border-radius: 10px; color: white; margin-bottom: 15px;
        }
        label { display: block; margin-bottom: 5px; color: var(--primary); font-size: 0.8rem; }

        button.action-btn {
            width: 100%; padding: 12px; background: linear-gradient(45deg, var(--primary), #0072ff);
            border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer;
        }

        /* Attendance Buttons */
        .att-btns { display: flex; gap: 10px; margin-top: 10px; }
        .btn-p { background: #00ff88 !important; color: black !important; }
        .btn-a { background: #ff4b2b !important; color: white !important; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 15px; border-bottom: 1px solid var(--glass-border); }
        th { color: var(--primary); font-family: 'Orbitron'; font-size: 0.8rem; }

        .shift-badge { padding: 3px 8px; border-radius: 5px; font-size: 0.7rem; font-weight: bold; }
        .day { background: #ff9800; color: #000; }
        .night { background: #3f51b5; color: #fff; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="glass-card" style="width: 350px;">
        <h2 style="text-align: center; color: var(--primary); font-family: 'Orbitron'; margin-bottom: 20px;">ADMIN LOGIN</h2>
        <input type="email" id="loginEmail" placeholder="Email">
        <input type="password" id="loginPass" placeholder="Password">
        <button class="action-btn" onclick="login()">Enter System</button>
    </div>
</div>

<div class="container" id="mainSystem">
    <header style="text-align: center; margin-bottom: 30px;">
        <h1 style="font-family: 'Orbitron'; color: var(--primary);">FACTORY HUB</h1>
        <button onclick="logout()" style="background:none; border:none; color:red; cursor:pointer;">[ Logout ]</button>
    </header>

    <div class="nav-tabs">
        <button class="tab-btn active" onclick="showSection('register')">Registration</button>
        <button class="tab-btn" onclick="showSection('attendance')">Daily Attendance</button>
        <button class="tab-btn" onclick="showSection('salary')">Salary Report</button>
    </div>

    <div id="register" class="section active">
        <div class="glass-card" style="max-width: 600px; margin: 0 auto;">
            <h2>Worker Details</h2>
            <input type="text" id="wName" placeholder="Worker Name">
            <input type="text" id="wMobile" placeholder="Mobile Number">
            <input type="text" id="wUpi" placeholder="UPI ID (optional)">
            <label>Shift Type</label>
            <select id="wShift">
                <option value="Day">Day Shift (‚òÄÔ∏è)</option>
                <option value="Night">Night Shift (üåô)</option>
            </select>
            <label>8-Hour Basic Salary (‚Çπ)</label>
            <input type="number" id="wBaseSalary" placeholder="Example: 400">
            <button class="action-btn" onclick="addWorker()">Save Worker Profile</button>
        </div>
    </div>

    <div id="attendance" class="section">
        <div class="glass-card">
            <h2>Mark Attendance (Today)</h2>
            <div id="attendanceList">
                <p style="opacity:0.5">Loading workers...</p>
            </div>
        </div>
    </div>

    <div id="salary" class="section">
        <div class="glass-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2>Weekly Payout (Sat)</h2>
                <input type="text" id="searchBox" onkeyup="filterSalary()" placeholder="Search Name..." style="width:200px; margin-bottom:0;">
            </div>
            <div style="overflow-x: auto;">
                <table id="salaryTable">
                    <thead>
                        <tr>
                            <th>Worker</th>
                            <th>Shift</th>
                            <th>Total Hrs</th>
                            <th>8hr Base</th>
                            <th>Net Payout</th>
                        </tr>
                    </thead>
                    <tbody id="salaryBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyD1GoChSmMELhRjxYHgJiJq3F85dldINGE",
        authDomain: "tap-tap-eae08.firebaseapp.com",
        projectId: "tap-tap-eae08",
        storageBucket: "tap-tap-eae08.firebasestorage.app",
        messagingSenderId: "734680519369",
        appId: "1:734680519369:web:6d7a0cd549aa31c6277318"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // UI Navigation
    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
        if(id === 'attendance') loadAttendanceList();
        if(id === 'salary') loadSalaryReport();
    }

    // Auth
    function login() {
        const e = document.getElementById('loginEmail').value;
        const p = document.getElementById('loginPass').value;
        auth.signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
    }
    function logout() { auth.signOut(); }

    auth.onAuthStateChanged(user => {
        if(user) {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainSystem').style.display = 'block';
        } else {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('mainSystem').style.display = 'none';
        }
    });

    // 1. Worker Add
    async function addWorker() {
        const worker = {
            name: document.getElementById('wName').value,
            mobile: document.getElementById('wMobile').value,
            upi: document.getElementById('wUpi').value,
            shift: document.getElementById('wShift').value,
            baseSalary8hr: parseFloat(document.getElementById('wBaseSalary').value),
            hourlyRate: parseFloat(document.getElementById('wBaseSalary').value) / 8
        };
        await db.collection("workers").add(worker);
        alert("Worker Saved!");
        location.reload();
    }

    // 2. Attendance List
    async function loadAttendanceList() {
        const list = document.getElementById('attendanceList');
        list.innerHTML = "";
        const snap = await db.collection("workers").get();
        snap.forEach(doc => {
            const w = doc.data();
            const div = document.createElement('div');
            div.className = "glass-card";
            div.style.marginBottom = "10px";
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <strong>${w.name}</strong> 
                        <span class="shift-badge ${w.shift.toLowerCase()}">${w.shift}</span>
                    </div>
                    <div class="att-btns">
                        <button class="tab-btn btn-p" onclick="mark('${doc.id}', 11.5)">P (11.5h)</button>
                        <button class="tab-btn btn-a" onclick="mark('${doc.id}', 0)">A (0h)</button>
                    </div>
                </div>
            `;
            list.appendChild(div);
        });
    }

    async function mark(id, hrs) {
        await db.collection("attendance").add({
            workerId: id,
            hours: hrs,
            date: new Date().toDateString(),
            timestamp: new Date()
        });
        alert("Marked: " + hrs + " hrs");
    }

    // 3. Salary Report
    let reportCache = [];
    async function loadSalaryReport() {
        const body = document.getElementById('salaryBody');
        body.innerHTML = "<tr><td colspan='5'>Calculating...</td></tr>";
        
        const wSnap = await db.collection("workers").get();
        const start = new Date(); start.setDate(start.getDate() - 7);
        const aSnap = await db.collection("attendance").where("timestamp", ">=", start).get();
        
        let attData = []; aSnap.forEach(d => attData.push(d.data()));
        
        body.innerHTML = "";
        reportCache = [];

        wSnap.forEach(doc => {
            const w = doc.data();
            let totalHrs = 0;
            attData.forEach(r => { if(r.workerId === doc.id) totalHrs += r.hours; });
            
            // Salary Logic: Total Hrs * (8hr_Salary / 8)
            let payout = totalHrs * (w.baseSalary8hr / 8);
            
            const row = {
                name: w.name,
                shift: w.shift,
                hrs: totalHrs,
                base: w.baseSalary8hr,
                pay: payout.toFixed(2)
            };
            reportCache.push(row);
            displayRow(row);
        });
    }

    function displayRow(r) {
        const body = document.getElementById('salaryBody');
        body.innerHTML += `
            <tr>
                <td>${r.name}</td>
                <td><span class="shift-badge ${r.shift.toLowerCase()}">${r.shift}</span></td>
                <td>${r.hrs} hrs</td>
                <td>‚Çπ${r.base}</td>
                <td style="color:var(--primary); font-weight:bold;">‚Çπ${r.pay}</td>
            </tr>
        `;
    }

    function filterSalary() {
        const q = document.getElementById('searchBox').value.toLowerCase();
        const body = document.getElementById('salaryBody');
        body.innerHTML = "";
        reportCache.filter(r => r.name.toLowerCase().includes(q)).forEach(displayRow);
    }
</script>
</body>
</html>
